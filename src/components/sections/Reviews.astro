---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
const reviews: CollectionEntry<'reviews'>[] = await getCollection('reviews');

import ButtonLink from '@ui/ButtonLink.astro';
import ReviewCard from '@ui/ReviewCard.astro';
import Gallery from '@ui/Gallery.astro';

const backgroundColors = ['teal', 'green', 'blue'];
---

<section class="">
  <div class="gallery">
    <Gallery />
  </div>

  <div class="title content">
    <h2 class="heading">Hear From my Students</h2>
    <p><em>Real feedback from people who learned and improved with me</em></p>
  </div>

  <div class="reviews-scroll">
    <ul class="reviews-track">
      <!-- clone dÃ©but -->
      {
        reviews.slice(-4).map((review) => (
          <li aria-hidden="true">
            clone beginning
            <ReviewCard
              review={review}
              color={
                backgroundColors[
                  Math.floor(Math.random() * backgroundColors.length)
                ]
              }
            />
          </li>
        ))
      }
      {
        reviews.map((review) => (
          <li>
            <ReviewCard
              review={review}
              color={
                backgroundColors[
                  Math.floor(Math.random() * backgroundColors.length)
                ]
              }
            />
          </li>
        ))
      }
      <!-- clone fin -->
      {
        reviews.slice(0, 4).map((review) => (
          <li aria-hidden="true">
            clone end
            <ReviewCard
              review={review}
              color={
                backgroundColors[
                  Math.floor(Math.random() * backgroundColors.length)
                ]
              }
            />
          </li>
        ))
      }
    </ul>
  </div>

  <div class="content">
    <div class="link-container">
      <ButtonLink
        href="https://maps.app.goo.gl/hSZ6TyxASJ45N4v18"
        color="white"
      >
        More reviews on Google Maps
      </ButtonLink>
    </div>
  </div>
</section>

<script is:inline>
  window.addEventListener('load', () => {
    const container = document.querySelectorAll('.reviews-scroll');
    console.log(container);
    const reviews = document.querySelectorAll('.reviews-track li');
    console.log(reviews);
    if (container && reviews) {
      const itemWidth = reviews[0].offsetWidth;
      console.log(itemWidth);
      console.log(itemWidth * 3);
      console.log(container.scrollLeft, container.clientWidth);

      container.scrollLeft += itemWidth * 3;
    }
  });
</script>

<style>
  section {
    /* padding-top: 8rem; */
    padding-bottom: 8rem;

    display: flex;
    flex-direction: column;
    gap: 6rem;
  }

  .title {
    text-align: center;
  }

  .reviews-scroll {
    overflow-x: auto;
    overflow-y: visible;
    position: relative;

    -ms-overflow-style: none; /* Internet Explorer 10+ */
    scrollbar-width: none; /* Firefox, Safari 18.2+, Chromium 121+ */
    padding: 0 2rem;

    scroll-snap-type: x mandatory;
  }

  .reviews-scroll::-webkit-scrollbar {
    display: none; /* Older Safari and Chromium */
  }

  .reviews-track {
    display: flex;
    gap: 2rem;

    /* padding-inline: calc((100vw - 1200px) / 2); */
  }

  .reviews-track li {
    flex: 0 0 30%;
    scroll-snap-align: center;
    /* width: 40%; */
    /* flex: 1; */
    /* min-width: 320px; */
  }

  /* .reviews {
    display: flex;
    gap: 2rem;
    overflow-x: auto;
    -ms-overflow-style: none; /* Internet Explorer 10+ *
    scrollbar-width: none; /* Firefox, Safari 18.2+, Chromium 121+ *
  }

  .reviews::-webkit-scrollbar {
    display: none; /* Older Safari and Chromium *
  }

  .review {
    flex: 1;

    padding: 2rem 1.5rem;
    background-color: var(--color-blue-pastel);
    border-radius: 1rem;
    height: fit-content;

    min-width: 300px;
  } */

  .link-container {
    margin: 0 auto;
    width: fit-content;
  }
</style>
